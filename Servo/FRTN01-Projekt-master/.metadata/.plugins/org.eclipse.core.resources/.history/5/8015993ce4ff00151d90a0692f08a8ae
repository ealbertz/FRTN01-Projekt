package regulator;

public class ControllerWithObserver {
	private ControlParameters cp;
	private double x1;
	private double x2;
	private double v;



	public ControllerWithObserver () {
		cp = new ControlParameters();

		cp.phi11 = 0.994;
		cp.phi12 = 0;
		cp.phi21 = 0.2493;
		cp.phi22 = 1;
		cp.gamma1 = 0.1122;
		cp.gamma2 = 0.01403;
		cp.l1 = 3.2898;
		cp.l2 = 1.7831;
		cp.lr = 1.7831;
		cp.k1 = 2.0361;
		cp.k2 = 1.2440;
		cp.kv = 3.2096;
	}

	// Calculates the control signal v.
	public synchronized double calculateOutput(double r, double y) {
		double 
		
		return cp.lr*r-cp.l1*x1-cp.l2*x2-v;
		
	}

	// Updates the controller state.
	public synchronized void updateState(double r, double y) {
		float eps=y-x2;
		x1=phi11*x1+phi12*x2+gamma1*(u+v)+k1*eps;
		x2=phi21*x1+phi22*x2+gamma2*(u+v)+k2*eps;
		v= v+kv*eps;

	}

	// Returns the sampling interval expressed as a long.
	// Note: Explicit type casting needed
	public synchronized long getHMillis() {
		return (long) (p.h * 1000.0);
	}



	// Sets the I-part of the controller to 0.
	// For example needed when changing controller mode.
	public synchronized void reset() {
		x1 = 0;
		x2 = 0;
		v = 0;

	}
}
